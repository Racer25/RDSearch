var ConnectionProvider = require("../dao/ConnectionProvider.js");
var mysql = require('mysql');

var getRareDisease_Symptom = function(orphanetID, name, callback)
{
    var connection=ConnectionProvider.getConnection();

    var sql = "SELECT * FROM provok WHERE name=? AND orphanetID=?";
    var inserts = [name, orphanetID];
    sql = mysql.format(sql, inserts);

    connection.query(sql, function (error, results, fields) {
        if (error) throw error;
        callback(results[0]);
    });
};

var getRareDisease_SymptomFromOrphanetID = function(orphanetID, callback)
{
    var connection=ConnectionProvider.getConnection();

    var sql = "SELECT * FROM provok WHERE orphanetID=?";
    var inserts = [orphanetID];
    sql = mysql.format(sql, inserts);

    connection.query(sql, function (error, results, fields) {
        if (error) throw error;
        callback(results);
    });
};

var getRareDisease_Symptoms = function(callback)
{
    var connection=ConnectionProvider.getConnection();

    var sql = "SELECT * FROM provok";
    var inserts = [];
    sql = mysql.format(sql, inserts);

    connection.query(sql, function (error, results, fields) {
        if (error) throw error;
        callback(results);
    });
};

var addOrModifyRareDisease_Symptom = function(rareDisease_Symptom, callback)
{
    var connection=ConnectionProvider.getConnection();

    var sql = "INSERT INTO provok(orphanetID, name, weight) "+
        "VALUES(?, ?, ?) ON DUPLICATE KEY "+
        "UPDATE weight=?";
    var inserts = [rareDisease_Symptom.orphanetID, rareDisease_Symptom.name, rareDisease_Symptom.weight, rareDisease_Symptom.weight];
    sql = mysql.format(sql, inserts);
    console.log(sql);

    connection.query(sql, function (error, results, fields) {
        if (error) throw error;
        callback();
    });
};

exports.getRareDisease_Symptom=getRareDisease_Symptom;
exports.getRareDisease_Symptoms=getRareDisease_Symptoms;
exports.addOrModifyRareDisease_Symptom=addOrModifyRareDisease_Symptom;
exports.getRareDisease_SymptomFromOrphanetID=getRareDisease_SymptomFromOrphanetID;