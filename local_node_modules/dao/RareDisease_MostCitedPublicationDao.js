var ConnectionProvider=require("./ConnectionProvider");
var mysql = require('mysql');

var addRareDisease_MostCitedPublication = function(rareDisease_MostCitedPublication, callback)
{
    var connection=ConnectionProvider.getConnection();

    var sql = "INSERT INTO speak_about(idPublication, orphanetID, timesCited) "+
        "VALUES(?, ?, ?) ON DUPLICATE KEY UPDATE timesCited=?";
    var inserts = [rareDisease_MostCitedPublication.idPublication, rareDisease_MostCitedPublication.orphanetID,
        rareDisease_MostCitedPublication.timesCited, rareDisease_MostCitedPublication.timesCited];
    sql = mysql.format(sql, inserts);

    connection.query(sql, function (error, results, fields) {
        if (error) throw error;
        callback();
    });
};

var getRareDisease_MostCitedPublication = function(idPublication, orphanetID, callback)
{
    var connection=ConnectionProvider.getConnection();

    var sql = "SELECT * FROM speak_about WHERE idPublication=? AND orphanetID=?";
    var inserts = [idPublication, orphanetID];
    sql = mysql.format(sql, inserts);

    connection.query(sql, function (error, results, fields) {
        if (error) throw error;
        callback(results[0]);
    });
};

var getRareDisease_MostCitedPublicationFromOrphanetID = function(orphanetID, callback)
{
    var connection=ConnectionProvider.getConnection();

    var sql = "SELECT * FROM speak_about WHERE orphanetID=? ORDER BY timesCited DESC";
    var inserts = [orphanetID];
    sql = mysql.format(sql, inserts);

    connection.query(sql, function (error, results, fields) {
        if (error) throw error;
        callback(results);
    });
};

exports.addRareDisease_MostCitedPublication=addRareDisease_MostCitedPublication;
exports.getRareDisease_MostCitedPublication=getRareDisease_MostCitedPublication;
exports.getRareDisease_MostCitedPublicationFromOrphanetID=getRareDisease_MostCitedPublicationFromOrphanetID;