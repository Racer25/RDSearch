var ConnectionProvider = require("../dao/ConnectionProvider.js");
var mysql = require('mysql');

var getYear = function(yearString, callback)
{
    var connection=ConnectionProvider.getConnection();

    var sql = "SELECT * FROM year WHERE year=?";
    var inserts = [yearString];
    sql = mysql.format(sql, inserts);

    connection.query(sql, function (error, results, fields) {
        if (error) throw error;
        callback(results);
    });
};

var getYears = function(callback)
{
    var connection=ConnectionProvider.getConnection();

    var sql = "SELECT * FROM year ORDER BY year DESC";
    var inserts = [];
    sql = mysql.format(sql, inserts);

    connection.query(sql, function (error, results, fields) {
        if (error) throw error;
        callback(results);
    });
};

var addOrModifyYear = function(year, callback)
{
    var connection=ConnectionProvider.getConnection();

    var sql = "INSERT INTO year(year, numberOfPublications) "+
        "VALUES(?, ?) ON DUPLICATE KEY "+ 
        "UPDATE numberOfPublications=?";
    var inserts = [year.year, year.numberOfPublications, year.numberOfPublications];
    sql = mysql.format(sql, inserts);

    connection.query(sql, function (error, results, fields) {
        if (error) throw error;
        callback();
    });
};

exports.getYear=getYear;
exports.getYears=getYears;
exports.addOrModifyYear=addOrModifyYear;