var ConnectionProvider=require("./ConnectionProvider");
var mysql = require('mysql');

var addPublication = function(publication, callback)
{
    var connection=ConnectionProvider.getConnection();
    var sql = "INSERT INTO mostcitedpublication(idPublication, title, abstract, authors, doi, datePublication) "+
        "VALUES(?, ?, ?, ?, ?, ?) ON DUPLICATE KEY UPDATE title=?, abstract=?, authors=?, doi=?, datePublication=?";
    var inserts = [publication.idPublication, publication.title, publication.abstract, publication.authors.toString(),
        publication.doi, publication.lastUpdateDate,
        publication.title, publication.abstract, publication.authors.toString(),
        publication.doi, publication.lastUpdateDate];
    sql = mysql.format(sql, inserts);

    connection.query(sql, function (error, results, fields) {
        if (error)
        {
            console.log(publication);
            throw error;
        }
        callback();
    });
};

var getPublication = function(idPublication, callback)
{
    var connection=ConnectionProvider.getConnection();
    var sql = "SELECT * FROM mostcitedpublication WHERE idPublication=?";
    var inserts = [idPublication];
    sql = mysql.format(sql, inserts);

    connection.query(sql, function (error, results, fields) {
        if (error)
        {
            throw error;
        }
        callback(results[0]);
    });
};

exports.addPublication=addPublication;
exports.getPublication=getPublication;